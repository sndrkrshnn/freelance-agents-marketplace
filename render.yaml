# ============================================
# Render.com Deployment Configuration
# Freelance AI Agents Marketplace - Free Tier
# ============================================

# This file defines all services for deployment on Render.com
# To deploy: Simply push to a connected GitHub repository
# Render will automatically detect and deploy these services

# =============================================
# PostgreSQL Database Service
# Free Tier: 512MB storage, 90 connections
# =============================================
databases:
  - name: freelance-agents-marketplace-db
    databaseName: freelance_agents_marketplace
    user: freelance_user

# =============================================
# Services (Redis + Web API)
# =============================================
services:
  # =============================================
  # Redis Cache Service
  # Free Tier: 25MB storage, 10 connections
  # =============================================
  - type: redis
    name: freelance-agents-marketplace-redis
    region: oregon
    plan: starter
    maxmemoryPolicy: allkeys-lru
    ipAllowList:
      - source: 0.0.0.0/0
        description: Allow all IPs for development

  # =============================================
  # Backend Web Service (Node.js API)
  # Free Tier: 512MB RAM, 0.1 CPU
  # Spins down after 15 minutes of inactivity
  # =============================================
  - type: web
    name: freelance-agents-marketplace-api
    env: docker
    region: oregon
    plan: starter
    branch: main
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend

    # Render will automatically use PORT env var
    # Health check configuration
    healthCheckPath: /health
    healthCheckInterval: 30
    healthCheckTimeout: 10
    healthCheckInitialDelay: 40

    # Auto-deploy on push to main branch
    autoDeploy: true

    # Environment variables
    envVars:
      # Node environment
      - key: NODE_ENV
        value: production

      # Port (Render sets this automatically)
      - key: PORT
        value: 5000

      # CORS Origin (will be replaced with frontend URL during deployment)
      - key: CORS_ORIGIN
        value: https://freelance-agents-marketplace.vercel.app

      # Database URL (Render will inject this automatically)
      - key: DATABASE_URL
        fromDatabase:
          name: freelance-agents-marketplace-db
          property: connectionString

      # Redis URL (Render will inject this automatically)
      - key: REDIS_URL
        fromService:
          type: redis
          name: freelance-agents-marketplace-redis
          property: connectionString

      # JWT Secret (generate unique value for production)
      - key: JWT_SECRET
        generateValue: true

      - key: JWT_EXPIRES_IN
        value: 7d

      # JWT Refresh Token Secret
      - key: JWT_REFRESH_SECRET
        generateValue: true

      - key: JWT_REFRESH_EXPIRES_IN
        value: 30d

      # Stripe Keys (use test keys - replace with your own)
      - key: STRIPE_SECRET_KEY
        value: sk_test_YOUR_STRIPE_SECRET_KEY

      - key: STRIPE_WEBHOOK_SECRET
        generateValue: true

      # Email Configuration (optional - for notifications)
      - key: SMTP_HOST
        value: smtp.gmail.com

      - key: SMTP_PORT
        value: 587

      # File Upload Configuration
      - key: MAX_FILE_SIZE
        value: 10485760

      - key: UPLOAD_DIR
        value: ./uploads

      # Rate Limiting Configuration
      - key: RATE_LIMIT_WINDOW_MS
        value: 900000

      - key: RATE_LIMIT_MAX_REQUESTS
        value: 100

      # WebSocket Configuration
      - key: WS_PATH
        value: /ws

      # Logging Configuration
      - key: LOG_LEVEL
        value: info

      - key: LOG_FORMAT
        value: json
