#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-push checks..."
echo "ğŸ“ Running full test suite..."

# Frontend tests with coverage
echo "ğŸ“¦ Running frontend test suite with coverage..."
cd frontend
npm run test:coverage || {
  echo "âŒ Frontend tests with coverage failed"
  exit 1
}

echo "ğŸ“Š Frontend coverage meets thresholds âœ…"
cd ..

# Backend tests with coverage
echo "ğŸ“¦ Running backend test suite with coverage..."
cd backend
npm test -- --coverage || {
  echo "âŒ Backend tests with coverage failed"
  exit 1
}

echo "ğŸ“Š Backend coverage meets thresholds âœ…"
cd ..

# E2E tests (optional, can be skipped with SKIP_E2E=true)
if [ "$SKIP_E2E" != "true" ]; then
  echo "ğŸŒ Running E2E tests..."
  cd frontend
  npm run test:e2e || {
    echo "âŒ E2E tests failed"
    echo "ğŸ’¡ Tip: Use SKIP_E2E=true to skip E2E tests during push"
    exit 1
  }
  echo "ğŸ¯ E2E tests passed âœ…"
  cd ..
else
  echo "â­ï¸  Skipping E2E tests (SKIP_E2E=true)"
fi

echo "âœ… All pre-push checks passed!"
echo "ğŸš€ Ready to push!"
